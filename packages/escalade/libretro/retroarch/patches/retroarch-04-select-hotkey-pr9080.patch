From eff6a4a7effff53fbf7b5b8ea5edbc8ca2d70f08 Mon Sep 17 00:00:00 2001
From: paradadf <paradadf@users.noreply.github.com>
Date: Mon, 8 Jul 2019 22:39:18 -0400
Subject: [PATCH 1/2] fix SELECT as hotkey sometimes messy with arcade

This fixes the hotkey being sometimes messy with arcade when on SELECT.
---
 retroarch.c | 27 +++++++++++++++++++++++----
 1 file changed, 23 insertions(+), 4 deletions(-)

diff --git a/retroarch.c b/retroarch.c
index f9f1618b9a..9491654315 100644
--- a/retroarch.c
+++ b/retroarch.c
@@ -3041,6 +3041,10 @@ static unsigned input_driver_max_users            = 0;
 static const void *hid_data                       = NULL;
 #endif
 
+/* number of frames required to trigger the hotkey */
+#define HOTKEY_DELAY 5
+static unsigned hotkey_counter = 0;
+
 /**
  * check_input_driver_block_hotkey:
  *
@@ -4771,11 +4775,18 @@ static void input_menu_keys_pressed(input_bits_t *p_new_state)
                && current_input->input_state(current_input_data, joypad_info,
                   &binds[0], port, RETRO_DEVICE_JOYPAD, 0, RARCH_ENABLE_HOTKEY))
          {
-            input_driver_block_libretro_input = true;
-            break;
+            if (hotkey_counter < HOTKEY_DELAY)
+               hotkey_counter++;
+            if (hotkey_counter >= HOTKEY_DELAY)
+            {
+               input_driver_block_libretro_input = true;
+               break;
+            }
+               
          }
          else
          {
+            hotkey_counter = 0;
             input_driver_block_hotkey         = true;
             break;
          }
@@ -4890,9 +4901,17 @@ static void input_keys_pressed(input_bits_t *p_new_state)
             && current_input->input_state(
                current_input_data, joypad_info, &binds, 0,
                RETRO_DEVICE_JOYPAD, 0, RARCH_ENABLE_HOTKEY))
-         input_driver_block_libretro_input = true;
-      else
+      {
+         if (hotkey_counter < HOTKEY_DELAY)
+            hotkey_counter++;
+         if (hotkey_counter >= HOTKEY_DELAY)
+         {
+            input_driver_block_libretro_input = true;
+         }
+      else {
+         hotkey_counter = 0;
          input_driver_block_hotkey         = true;
+      }
    }
 
    if (binds[RARCH_GAME_FOCUS_TOGGLE].valid)

From 76ebb9a85c75c49221f38acddd4f4635719e86fd Mon Sep 17 00:00:00 2001
From: paradadf <paradadf@users.noreply.github.com>
Date: Tue, 9 Jul 2019 07:14:42 -0400
Subject: [PATCH 2/2] missing curly brace

add missing curly brace
---
 retroarch.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/retroarch.c b/retroarch.c
index 9491654315..6c0b06f591 100644
--- a/retroarch.c
+++ b/retroarch.c
@@ -4908,6 +4908,7 @@ static void input_keys_pressed(input_bits_t *p_new_state)
          {
             input_driver_block_libretro_input = true;
          }
+      }
       else {
          hotkey_counter = 0;
          input_driver_block_hotkey         = true;
